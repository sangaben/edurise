{% extends "base.html" %}
{% load static %}

{% block title %}EduRise | Upload Resources{% endblock %}

{% block extra_css %}
<style>
    .upload-hero {
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.95) 0%, rgba(114, 9, 183, 0.9) 100%), url('{% static "images/upload-bg.jpg" %}');
        background-size: cover;
        background-position: center;
        padding: 5rem 0 3rem;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .upload-hero:before {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 100px;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23f8f9fa' fill-opacity='1' d='M0,224L80,192C160,160,320,96,480,96C640,96,800,160,960,186.7C1120,213,1280,203,1360,197.3L1440,192L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z'%3E%3C/path%3E%3C/svg%3E") no-repeat;
        background-size: cover;
        background-position: bottom;
    }
    
    .upload-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        padding: 2rem;
        margin-top: -50px;
        position: relative;
        z-index: 10;
    }
    
    .upload-card {
        border: 2px dashed var(--gray-light);
        border-radius: 12px;
        padding: 2.5rem;
        text-align: center;
        transition: all 0.3s;
        background: rgba(67, 97, 238, 0.03);
        cursor: pointer;
    }
    
    .upload-card:hover {
        border-color: var(--primary);
        background: rgba(67, 97, 238, 0.05);
        transform: translateY(-5px);
    }
    
    .upload-icon {
        font-size: 3.5rem;
        color: var(--primary);
        margin-bottom: 1rem;
    }
    
    .file-input {
        display: none;
    }
    
    .file-list {
        margin-top: 2rem;
    }
    
    .file-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: var(--light);
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    
    .file-icon {
        font-size: 1.5rem;
        color: var(--primary);
        margin-right: 1rem;
    }
    
    .file-details {
        flex-grow: 1;
    }
    
    .file-name {
        font-weight: 500;
        margin-bottom: 0.2rem;
    }
    
    .file-size {
        font-size: 0.85rem;
        color: var(--gray);
    }
    
    .file-remove {
        color: var(--accent);
        cursor: pointer;
        font-size: 1.2rem;
    }
    
    .upload-form-group {
        margin-bottom: 1.5rem;
    }
    
    .upload-form-group label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: var(--dark);
    }
    
    .form-select, .form-control {
        padding: 0.8rem 1.2rem;
        border-radius: 8px;
        border: 1px solid var(--gray-light);
        transition: all 0.3s;
    }
    
    .form-select:focus, .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
    }
    
    .upload-btn {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        box-shadow: 0 5px 15px rgba(67, 97, 238, 0.25);
        transition: all 0.3s;
        width: 100%;
        margin-top: 1rem;
    }
    
    .upload-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(67, 97, 238, 0.35);
    }
    
    .upload-btn:disabled {
        background: var(--gray-light);
        color: var(--gray);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .upload-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        position: relative;
    }
    
    .upload-steps:before {
        content: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gray-light);
        z-index: 1;
    }
    
    .step {
        position: relative;
        z-index: 2;
        text-align: center;
        width: 30%;
    }
    
    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: 2px solid var(--gray-light);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.5rem;
        font-weight: 600;
        color: var(--gray);
        transition: all 0.3s;
    }
    
    .step.active .step-number {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }
    
    .step.completed .step-number {
        background: var(--success);
        border-color: var(--success);
        color: white;
    }
    
    .step-title {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--gray);
    }
    
    .step.active .step-title {
        color: var(--primary);
    }
    
    .step.completed .step-title {
        color: var(--success);
    }
    
    .upload-tab {
        display: none;
    }
    
    .upload-tab.active {
        display: block;
    }
    
    .access-denied {
        text-align: center;
        padding: 3rem 2rem;
    }
    
    .access-denied-icon {
        font-size: 4rem;
        color: var(--accent);
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 768px) {
        .upload-container {
            margin-top: -30px;
            padding: 1.5rem;
        }
        
        .upload-card {
            padding: 1.5rem;
        }
        
        .upload-steps {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .upload-steps:before {
            display: none;
        }
        
        .step {
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .step-number {
            margin: 0 1rem 0 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Upload Hero Section -->
<section class="upload-hero">
    <div class="container position-relative">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">Share Your Knowledge</h1>
                <p class="lead mb-4">Upload educational resources to help empower Ugandan youth with quality learning materials.</p>
            </div>
        </div>
    </div>
</section>

<!-- Upload Container -->
<section class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="upload-container">
                {% if user.is_authenticated and user.profile.role == 'teacher' %}
                    <!-- Upload Steps -->
                    <div class="upload-steps mb-5">
                        <div class="step active" id="step1">
                            <div class="step-number">1</div>
                            <div class="step-title">Select Files</div>
                        </div>
                        <div class="step" id="step2">
                            <div class="step-number">2</div>
                            <div class="step-title">Add Details</div>
                        </div>
                        <div class="step" id="step3">
                            <div class="step-number">3</div>
                            <div class="step-title">Complete</div>
                        </div>
                    </div>
                    
                    <!-- Step 1: File Selection -->
                    <div class="upload-tab active" id="tab1">
                        <h3 class="mb-4">Select Files to Upload</h3>
                        <div class="upload-card" id="dropZone">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>Drag & Drop Files Here</h4>
                            <p class="text-muted mb-3">or</p>
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open me-2"></i> Browse Files
                            </button>
                            <input type="file" id="fileInput" class="file-input" multiple>
                            <p class="text-muted mt-3">Supported formats: PDF, DOC, DOCX, PPT, PPTX, JPEG, PNG</p>
                        </div>
                        
                        <div class="file-list" id="fileList">
                            <!-- Files will be listed here -->
                        </div>
                        
                        <div class="text-end mt-4">
                            <button class="btn btn-primary" onclick="nextStep(2)">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: File Details -->
                    <div class="upload-tab" id="tab2">
                        <h3 class="mb-4">Add Resource Details</h3>
                        
                        <form id="uploadForm" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="upload-form-group">
                                        <label for="resourceTitle">Resource Title *</label>
                                        <input type="text" class="form-control" id="resourceTitle" name="title" required placeholder="Enter a descriptive title">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="upload-form-group">
                                        <label for="resourceSubject">Subject/Category *</label>
                                        <select class="form-select" id="resourceSubject" name="subject" required>
                                            <option value="">Select a subject</option>
                                            <option value="mathematics">Mathematics</option>
                                            <option value="sciences">Sciences</option>
                                            <option value="languages">Languages</option>
                                            <option value="technology">Technology</option>
                                            <option value="business">Business Studies</option>
                                            <option value="arts">Arts & Humanities</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upload-form-group">
                                <label for="resourceDescription">Description *</label>
                                <textarea class="form-control" id="resourceDescription" name="description" rows="4" required placeholder="Describe the resource content and its educational value"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="upload-form-group">
                                        <label for="resourceLevel">Education Level</label>
                                        <select class="form-select" id="resourceLevel" name="level">
                                            <option value="">Select level</option>
                                            <option value="primary">Primary School</option>
                                            <option value="secondary">Secondary School</option>
                                            <option value="tertiary">Tertiary/University</option>
                                            <option value="general">General Public</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="upload-form-group">
                                        <label for="resourceLanguage">Language</label>
                                        <select class="form-select" id="resourceLanguage" name="language">
                                            <option value="english">English</option>
                                            <option value="luganda">Luganda</option>
                                            <option value="other">Other Local Language</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upload-form-group">
                                <label>Resource Type</label>
                                <div class="d-flex flex-wrap gap-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="resourceType" id="typeTheory" value="theory" checked>
                                        <label class="form-check-label" for="typeTheory">
                                            <i class="fas fa-theater-masks me-1"></i> Theoretical
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="resourceType" id="typePractical" value="practical">
                                        <label class="form-check-label" for="typePractical">
                                            <i class="fas fa-flask me-1"></i> Practical
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="resourceType" id="typeBoth" value="both">
                                        <label class="form-check-label" for="typeBoth">
                                            <i class="fas fa-theater-masks me-1"></i> Both Theory & <i class="fas fa-flask me-1"></i> Practical
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-outline-primary" onclick="nextStep(1)">
                                    <i class="fas fa-arrow-left me-2"></i> Back
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Upload Resource <i class="fas fa-upload ms-2"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Step 3: Completion -->
                    <div class="upload-tab" id="tab3">
                        <div class="text-center py-4">
                            <div class="upload-icon text-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="mt-3">Upload Successful!</h3>
                            <p class="text-muted mb-4">Your resource has been uploaded and is now available to students across Uganda.</p>
                            
                            <div class="d-flex justify-content-center gap-3">
                                <a href="{% url 'upload' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-plus me-2"></i> Upload Another
                                </a>
                                <a href="{% url 'resources' %}" class="btn btn-primary">
                                    <i class="fas fa-eye me-2"></i> View Resource
                                </a>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <!-- Access Denied Message for non-teachers -->
                    <div class="access-denied">
                        <div class="access-denied-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h3>Access Restricted to Teachers</h3>
                        <p class="text-muted mb-4">
                            {% if user.is_authenticated %}
                                Your account doesn't have teacher privileges to upload resources.
                            {% else %}
                                You need to be logged in as a registered teacher to upload resources.
                            {% endif %}
                        </p>
                        
                        <div class="d-flex justify-content-center gap-3 flex-wrap">
                            {% if user.is_authenticated %}
                                <a href="{% url 'profile' %}" class="btn btn-primary">
                                    <i class="fas fa-user me-2"></i> View Profile
                                </a>
                                <a href="{% url 'resources' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-book me-2"></i> Browse Resources
                                </a>
                            {% else %}
                                <a href="{% url 'login' %}?next={% url 'upload' %}" class="btn btn-primary">
                                    <i class="fas fa-sign-in-alt me-2"></i> Login
                                </a>
                                <a href="{% url 'register' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-user-plus me-2"></i> Register
                                </a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% if user.is_authenticated and user.profile.role == 'teacher' %}
<!-- Upload Guidelines (Only shown to teachers) -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="text-center mb-4">Upload Guidelines</h2>
                
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5><i class="fas fa-check-circle text-success me-2"></i> Quality Content</h5>
                        <p class="mb-0">Ensure your resources are accurate, well-structured, and provide educational value to students.</p>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5><i class="fas fa-check-circle text-success me-2"></i> Appropriate Formatting</h5>
                        <p class="mb-0">Use clear headings, readable fonts, and proper formatting to enhance learning experience.</p>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5><i class="fas fa-check-circle text-success me-2"></i> Copyright Compliance</h5>
                        <p class="mb-0">Only upload resources you have created or have permission to share. Respect intellectual property rights.</p>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h5><i class="fas fa-check-circle text-success me-2"></i> Clear Descriptions</h5>
                        <p class="mb-0">Provide detailed descriptions to help users understand what your resource offers.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
{% if user.is_authenticated and user.profile.role == 'teacher' %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        let uploadedFiles = [];
        
        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropZone.style.borderColor = 'var(--primary)';
            dropZone.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
        }
        
        function unhighlight() {
            dropZone.style.borderColor = 'var(--gray-light)';
            dropZone.style.backgroundColor = 'rgba(67, 97, 238, 0.03)';
        }
        
        dropZone.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        fileInput.addEventListener('change', function() {
            handleFiles(this.files);
        });
        
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                uploadedFiles.push(file);
                displayFile(file);
            }
        }
        
        function displayFile(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            // Get file icon based on type
            let iconClass = 'fa-file';
            if (file.type.includes('image')) iconClass = 'fa-file-image';
            else if (file.type.includes('pdf')) iconClass = 'fa-file-pdf';
            else if (file.type.includes('word')) iconClass = 'fa-file-word';
            else if (file.type.includes('powerpoint') || file.type.includes('presentation')) iconClass = 'fa-file-powerpoint';
            
            // Format file size
            const fileSize = formatFileSize(file.size);
            
            fileItem.innerHTML = `
                <div class="file-icon">
                    <i class="fas ${iconClass}"></i>
                </div>
                <div class="file-details">
                    <div class="file-name">${file.name}</div>
                    <div class="file-size">${fileSize}</div>
                </div>
                <div class="file-remove" onclick="removeFile(this, ${uploadedFiles.length - 1})">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            fileList.appendChild(fileItem);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Form submission
        const uploadForm = document.getElementById('uploadForm');
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Simulate upload process
            const uploadBtn = this.querySelector('button[type="submit"]');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Uploading...';
            
            setTimeout(function() {
                nextStep(3);
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'Upload Resource <i class="fas fa-upload ms-2"></i>';
            }, 2000);
        });
    });
    
    function nextStep(step) {
        // Hide all tabs
        document.querySelectorAll('.upload-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active class from all steps
        document.querySelectorAll('.step').forEach(stepEl => {
            stepEl.classList.remove('active', 'completed');
        });
        
        // Show selected tab
        document.getElementById('tab' + step).classList.add('active');
        
        // Mark previous steps as completed and current as active
        for (let i = 1; i <= step; i++) {
            const stepEl = document.getElementById('step' + i);
            if (i < step) {
                stepEl.classList.add('completed');
            } else {
                stepEl.classList.add('active');
            }
        }
    }
    
    function removeFile(element, index) {
        // Remove from displayed list
        element.parentElement.remove();
        
        // Remove from uploaded files array
        uploadedFiles.splice(index, 1);
    }
</script>
{% endif %}
{% endblock %}